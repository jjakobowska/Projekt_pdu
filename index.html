<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mapa lotów</title>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="AnimatedMarker.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    const map = L.map('map').setView([10.0, -30.0], 2);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const markers = [
        { name: "Buenos Aires", coords: [-34.6037, -58.3816], flights: 72539 },
        { name: "Santiago (Chile)", coords: [-33.4489, -70.6693], flights: 52787 },
        { name: "Lizbona", coords: [38.7169, -9.1399], flights: 40243 },
        { name: "Miami", coords: [25.7617, -80.1918], flights: 29849 },
        { name: "Montevideo", coords: [-34.9011, -56.1645], flights: 21553 },
        { name: "Londyn", coords: [51.5074, -0.1278], flights: 21300 },
        { name: "Orlando", coords: [28.5383, -81.3792], flights: 20097 },
        { name: "Paryż", coords: [48.8566, 2.3522], flights: 19710 },
        { name: "Fort Lauderdale", coords: [26.1224, -80.1373], flights: 18133 },
        { name: "Madryt", coords: [40.4168, -3.7038], flights: 15047 },
        { name: "Nowy Jork", coords: [40.7128, -74.0060], flights: 14824 },
        { name: "Mediolan", coords: [45.4642, 9.1900], flights: 14236 },
        { name: "Frankfurt", coords: [50.1109, 8.6821], flights: 12058 },
        { name: "Bogotá", coords: [4.7110, -74.0721], flights: 11939 },
        { name: "Meksyk (CDMX)", coords: [19.4326, -99.1332], flights: 10231 },
        { name: "Rzym", coords: [41.9028, 12.4964], flights: 9215 },
        { name: "Lima", coords: [-12.0464, -77.0428], flights: 8668 },
    ];

    const brazilCoords = [-23.5505, -46.6333];

    const planeIcon = L.icon({
        iconUrl: 'pngtree-golden-color-3d-airplane-icon-design-png-image_16239586.png', // lokalny plik
        iconSize: [32, 32],
        iconAnchor: [16, 16]
    });

    // Stały znacznik Brazylii (czerwony)
    L.marker(brazilCoords, { icon: L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowUrl: 'https://unpkg.com/leaflet@1.6/dist/images/marker-shadow.png',
        shadowSize: [41, 41]
    }) }).addTo(map).bindTooltip("Brazylia", {sticky: true});

    let activeLine = null;
    let activePlane = null;

    function flyFromBrazilTo(destLatLng) {
        if (activeLine) map.removeLayer(activeLine);
        if (activePlane) map.removeLayer(activePlane);

        activeLine = L.polyline([brazilCoords, destLatLng], { color: 'gray', dashArray: '5' }).addTo(map);

        activePlane = L.animatedMarker(activeLine.getLatLngs(), {
            icon: planeIcon,
            autoStart: true,
            distance: 100,   // szybszy ruch
            interval: 30,
            onEnd: function () {
                map.removeLayer(activeLine);
                map.removeLayer(activePlane);
                activeLine = null;
                activePlane = null;
            }
        });

        map.addLayer(activePlane);
    }

    markers.forEach(city => {
        const marker = L.marker(city.coords).addTo(map);
        marker.bindTooltip(`<div>${city.name}<br>Liczba lotów: ${city.flights}</div>`, { sticky: true });
        marker.on('mouseover', () => flyFromBrazilTo(city.coords));
    });
</script>
</body>
</html>
